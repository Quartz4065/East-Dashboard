<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISR Data Hub</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            padding: 20px;
        }
        h1 {
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
        }
        th {
            background-color: #333;
            color: white;
        }
        .location-group, .isr-group {
            margin-top: 20px;
        }
        .location-header {
            background-color: #444;
            color: white;
            padding: 10px;
        }
        .isr-header {
            background-color: #555;
            color: white;
            padding: 8px;
        }
    </style>
</head>
<body>

<h1>ISR Data Hub</h1>

<div id="hub-content"></div>

<script>
    const apiKey = 'AIzaSyDUpztgaNLc1Vlq-ctxZbHo-ZRHl8wTJ60';  // Your API Key
    const spreadsheetId = '1COuit-HkAoUL3d5uv9TJbqxxOzNqkvNA0VbKl3apzOA';  // Your Spreadsheet ID

    // Tabs to be fetched
    const tabs = ['Daily', 'Previous Day'];  // Add more tabs if necessary

    const isrData = {};  // This will hold grouped data by ISR
    const locationData = {};  // This will hold grouped data by Location

    // Fetch data from all tabs
    function fetchData() {
        tabs.forEach(tab => {
            const range = `${tab}!A1:Z1000`;  // Adjust the range as needed

            fetch(`https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`)
                .then(response => response.json())
                .then(data => {
                    if (data.values) {
                        processTabData(tab, data.values);  // Process data for each tab
                    } else {
                        console.error(`No data found for tab: ${tab}`);
                    }
                })
                .catch(error => console.error(`Error fetching data for ${tab}:`, error));
        });
    }

    // Process the data from each tab and group by ISR and Location
    function processTabData(tab, rows) {
        const headers = rows[0];  // First row contains headers
        rows.slice(1).forEach(row => {
            const isrName = row[1];  // Assuming ISR Name is in the second column
            const location = row[0];  // Assuming Location is in the first column

            if (!isrData[isrName]) {
                isrData[isrName] = { tabs: {} };
            }
            if (!isrData[isrName].tabs[tab]) {
                isrData[isrName].tabs[tab] = [];
            }
            isrData[isrName].tabs[tab].push(row);

            if (!locationData[location]) {
                locationData[location] = { isrs: {} };
            }
            if (!locationData[location].isrs[isrName]) {
                locationData[location].isrs[isrName] = [];
            }
            locationData[location].isrs[isrName].push(row);
        });

        displayHub();  // Once all data is processed, display the hub
    }

    // Display the main hub with ISR and Location groups
    function displayHub() {
        const hubContent = document.getElementById('hub-content');
        hubContent.innerHTML = '';  // Clear the content before appending

        // Display by Location
        for (const location in locationData) {
            const locationGroup = document.createElement('div');
            locationGroup.classList.add('location-group');

            const locationHeader = document.createElement('div');
            locationHeader.classList.add('location-header');
            locationHeader.textContent = `Location: ${location}`;
            locationGroup.appendChild(locationHeader);

            const locationTable = document.createElement('table');
            locationGroup.appendChild(locationTable);

            for (const isr in locationData[location].isrs) {
                const isrGroup = document.createElement('div');
                isrGroup.classList.add('isr-group');

                const isrHeader = document.createElement('div');
                isrHeader.classList.add('isr-header');
                isrHeader.textContent = `ISR: ${isr}`;
                isrGroup.appendChild(isrHeader);

                const isrTable = document.createElement('table');
                const tableHeaderRow = document.createElement('tr');
                tableHeaderRow.innerHTML = `<th>Tab</th><th>Data</th>`;
                isrTable.appendChild(tableHeaderRow);

                for (const tab in isrData[isr].tabs) {
                    isrData[isr].tabs[tab].forEach(dataRow => {
                        const dataRowElem = document.createElement('tr');
                        dataRowElem.innerHTML = `<td>${tab}</td><td>${dataRow.join(', ')}</td>`;
                        isrTable.appendChild(dataRowElem);
                    });
                }

                isrGroup.appendChild(isrTable);
                locationGroup.appendChild(isrGroup);
            }

            hubContent.appendChild(locationGroup);
        }
    }

    // Call the fetchData function when the page loads
    fetchData();
</script>

</body>
</html>
